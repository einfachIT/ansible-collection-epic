---
- hosts: container
  gather_facts: false
  connection: local
  tasks:
    
  - name: Wait for docker api to get available
    wait_for:
      port: 2375
      host: "{{ hostvars[docker_host].ansible_host }}"
      # search_regex: Connected
    vars:
      ansible_connection: local
    delegate_to: localhost
    when: docker_host != 'localhost'

  - name: delete backup volume
    docker_volume:
      name: home_backup
      state: absent
      docker_host: "{{ docker_api }}"
    when: not (docker_keep_volumes | default(true))
    delegate_to: localhost

  - name: Stop container
    docker_container:
      name: "{{ inventory_hostname }}"
      docker_host: "{{ docker_api }}"
      keep_volumes: "{{ docker_keep_volumes | default(true) }} "
      container_default_behavior: no_defaults
      state: absent
    delegate_to: localhost
